;일기구상

;하루의 종료 시의 흐름
;@DIARY_TEXT_K134（日記本文）→@DIARY_AFTER_CHECK_K134（フラグの処理）


;◆일기의 사양◆
;※１@DIARY_BEFORE_CHECK_K134で日記のフラグが立つ。
;→ 미독플래그(2)가 서 있으면 하루의 끝에 데일리 이벤트로 일기가 읽힌다 (읽은것으로 된다).
;→ ※2미독플래그(3)가 서 있으면 [일기를 읽는다]로 읽을 수 있다。읽으면 읽음(1)이 된다.
;※1 각처 이벤트 구상이나 커맨드 구상에서 플래그를 세워도 좋습니다.
;※2 기본적으로 읽지 않음(2) 권장입니다. 읽음(1), 읽음(3)은 한 단계 필요.

;[日記を読む]には、持ち主が[연모]なら自由に読むことができ、
;そうでない場合は연모でない人物がその場に居ない時、もしくは時間停止することで盗み読みできる。
;拠点住民でないキャラは연모であれば自宅（초대방）で読むことができる。

;MAX_DIARY_PAGE:134:0　キャラ番号134の日記の最大ページ数　限度は101（1～100）
;DIARY:134:YY　　　　　キャラ番号134の日記番号YYの情報
;　　 3=미독　　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽으면 기독이 된다.
;　　 2=미독　　　　　데일리 이벤트로 읽힌다. 읽히기 전까지는 [일기를 읽는다]로는 읽을 수 없다. 읽히면 기독이 된다.
;　　 1=기독　　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽을 수 있다.
;　　 0=읽지못함　　　미해금.
;PAGESET:134:YY　　　　キャラ番号134の実際に書かれたYYページ目の日記番号。
;=============================
@DIARY_K134_EXIST
;존재판정
;0이면 일기는 쓸 수 없다.
;=============================
RETURN 1

;=============================
@DIARY_AFTER_CHECK_K134
;데일리 이벤트에서 일기가 읽혔을 때의 뒷처리.
;플래그 관리 등 자유롭게 취급해도 좋다.

;조건 플래그 리셋이나 판정 추가도 여기에 
;예를들어: 今日構ったフラグ
;今日構った일기가 표시된 후, 構ったフラグ를 리셋.
; CFLAG:134:今日構ったフラグ = 0
;혹은 어떠한 상태가 계속되는 것의 플래그인 경우
;예: 호감도가 거의 변하지 않는 날이 이어지면
;「아나타」의 태도가 차갑구나~ 같은 일기를 쓴다
; SIF CFLAG:134:호감도 <= LAST_LP+3
;   NOTOUCH_DAY ++
;=============================


;=============================
@DIARY_BEFORE_CHECK_K134
;상시 체크되는 일기의 상태 정보.
;ここでDIARY:134:YYの更新を行う。
;※DIARY:134:0番は使えません。

;여기서 범용 발생 조건을 기입한다
;커맨드별 발생 조건은 M_KOJO의 각 파일 안에서 추가해 주세요.

;基本的に発生条件には"DIARY:134:YY == 0"を入れること。
;그렇지 않으면 같은 일기가 쓰여지거나 해 버린다.

;DIARY:134:YY　　　　キャラ番号134の日記番号YYの情報
;　　 3=미독　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽으면 기독이 된다.
;　　 2=미독　　　　데일리 이벤트로 읽힌다. 읽히기 전까지는 [일기를 읽는다]로는 읽을 수 없다. 읽히면 기독이 된다.
;　　 1=기독　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽을 수 있다.
;　　 0=읽지못함　　미해금.

;○미독(2)로 하는 경우 (기본)
;미독(2)로 하면 데일리 이벤트로 발생, 하루의 끝에 하나만 읽힌다.
;여러 페이지가 미독(2)인 경우에는 번호가 작은 것이 읽히고, 그 이외는 리셋(0)된다.
;그래서, 여러 개가 동시에 발생하면, 발생했는데도 읽히지 않고 리셋 되는 경우도 있다.
;미독(2)로 하려면 단순히 플래그에 2를 넣기만 하면 된다.

;예1) 첫대면
;SIF DIARY:134:YY == 0 && CFLAG:134:안면
;	DIARY:134:YY = 2

;○미독(3)으로 하는 경우 (응용)
;미독(3)으로 하면 데일리 이벤트로써 읽히지 않고, 쓰여진 시점에서[일기를 읽는다]에 의해서 읽을 수 있게 된다.
;플레이어가 자주적으로 읽지 않는 한 읽히지 않고, 하루에 여러 페이지 가필되는 경우도 있다.
;未読(3)にするにはフラグに3を入れた上で、CALL CHARA_DIARY_PAGESETTING(134, YY)をする必要がある。

;예2) 호감도 100 이상
;IF DIARY:134:YY == 0 && CFLAG:134:호감도 >= 100
;	DIARY:134:YY = 3
;	CALL CHARA_DIARY_PAGESETTING(134, YY)
;ENDIF

;예3) 예2의 일기가 읽힌 후에 호감도 1000이상
;이것을 하면 YY를 읽은 직후 ZZ가 올라오는 일도 벌어진다.
;IF DIARY:134:ZZ == 0 && DIARY:134:YY == 1 && CFLAG:134:호감도 >= 1000
;	DIARY:134:ZZ = 3
;	CALL CHARA_DIARY_PAGESETTING(134, ZZ)
;ENDIF

;▽쓸데없는 참견의 주석
;ファーストキスは基本的に全員[키스미경험]を所持しているので、"!TALENT:134:키스미경험"で判定できます。
;데이트에서 돌아올때 키스로 분기하고 싶다면 데이트에서 돌아올때 키스 구상에서 플래그를 세웁시다.
;이 경우, 일반적인 첫키스 상실과 중복되지 않도록 주의합시다.
;처녀상실은 초기설정에서 처녀상실인 경우도 있으므로, 처녀상실 구상쪽에서 플래그를 세우는 것이 좋습니다.
;그 외 고백, 함락 등의 이벤트는 각종 이벤트 구상에서 플래그를 세웁시다. 첫대면은 그쪽도 괜찮아요.
;날짜를 정확히 세려면 별도의 플래그가 필요. 예를 들면 처음 만난 날이라든지.
;=============================
;MAXPAGE는 여기에 기입한다
MAX_DIARY_PAGE:134:0 = 1

;=============================
@DIARY_TEXT_K134, PAGENUM, MODE, PAGECOUNT
;일기의 내용
;PAGENUM   = 일기 번호 (일기의 패턴)
;MODE      = "デイリー":하루 종료시 데일리 이벤트에서 읽힘
;          = "コマンド":[일기를 읽는다] 커맨드로 읽힘
;PAGECOUNT = 몇 페이지째에 쓰여 있는가
;=============================
#DIM PAGENUM
#DIMS MODE
#DIM PAGECOUNT

;구상색 지정이 있으면 주석처리를 지운다
;CALL M_KOJO_COLOR_K134

;GROUPMATCH에 일기 ID를 넣어, 표시하고 싶은 얼굴 화상을 표시한다
;표정・복장・특수 화상을 옵션 지정으로 표시 (생략 가능)
;서식은 resources\顔.CSV와 아래 예시를 참조

;이하는 샘플
IF MODE == "デイリー"
	IF GROUPMATCH(PAGENUM, 1) 
		CALL PRINT_FACE, 134, "発情", "裸", "_1"
	ELSEIF GROUPMATCH(PAGENUM, 2)
		CALL PRINT_FACE, 134, "笑顔", "服1"
	ELSEIF GROUPMATCH(PAGENUM, 3)
		CALL PRINT_FACE, 134, "怒り"
	ELSE
		CALL PRINT_FACE, 134
	ENDIF
ENDIF

PRINTFORMDL - %CALLNAME:134%の日記　PAGE.{PAGECOUNT} --------------------------------------------------------------------------------------
PRINTL

;※PAGENUM:0은 사용할 수 없다
SELECTCASE PAGENUM
	CASE 1
		PRINTFORML ○月×日
		PRINTFORML 오늘부터、일기를 쓰기로 했다.
ENDSELECT

RESETCOLOR

;=============================
@M_KOJO_MESSAGE_COM_K134_406
;=============================
CALL TRAIN_MESSAGE
CALL M_KOJO_MESSAGE_COM_K134_406_1
RETURN RESULT

;=============================
@M_KOJO_MESSAGE_COM_K134_406_1
;커맨드 구상
;TFLAG:194 (누구의 일기를 읽고있는지)
;TFLAG:194が134でない場合は他人の日記なので注意。
;PAGE는 적혀있는 페이지 수.
;SHIRAHU(134)はキャラ134の状態が正常かどうか。
;=============================
#DIM PAGE

;이하는 샘플
PAGE = 0
FOR LOCAL, 0, MAX_DIARY_PAGE:(TFLAG:194):0
	IF GROUPMATCH(DIARY:(TFLAG:194):LOCAL, 1, 3)
		PAGE ++
	ENDIF
NEXT

IF SHIRAHU(134) && TFLAG:194 == 134
;일기를 다 읽고 난 후의 반응
	IF PAGE > 2
		CALL SPTALK, 134,"通常",0,@"「일기를 보여주다니…어쩐지 부끄럽네요…」//%CALLNAME:134%는 물끄러니 이쪽을 바라보고 있다"
		;화상포함 토크는 최대 6행까지.
	ELSE
		PRINTFORML 
	ENDIF
ENDIF