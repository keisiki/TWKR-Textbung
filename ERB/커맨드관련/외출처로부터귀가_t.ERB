@외출처로부터귀가
#DIM DIST_TO_HOME
IF !FLAG:데이트상대 && !FLAG:70 && BASE:MASTER:TSP >= TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) * 3
	PRINTL TSP를 소비하여 시간 경과 없이 귀가할 수 있습니다.
	PRINTL TSP를 사용하겠습니까?
	PRINTL [0] 아니오
	PRINTFORML [1] 네 (TSP{TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) * 3}소비)
	INPUT
	IF RESULT == 1
		IF BASE:MASTER:TSP < TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) * 3
			PRINTW TSP가 부족했다
		ELSE
			BASE:MASTER:TSP -= TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) * 3
			GOTO WARP
		ENDIF
	ENDIF
ENDIF
IF !FLAG:70
	CALL 귀가의시간경과
ELSEIF BASE:MASTER:TSP < TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) * 3
	PRINTW TSP가 부족하기 때문에 시간을 멈춘 상태로는 돌아갈 수 없다
	RETURN -1
ELSE
	BASE:MASTER:TSP -= TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) * 3
ENDIF

$WARP
PRINTFORMW \@ CFLAG:MASTER:데이트중 != CFLAG:TARGET:데이트중 || TARGET == MASTER ?  외출 # 데이트 \@에서 돌아왔습니다
CALL 모리야복권데이트상대의리셋()
FOR LOCAL, 1, CHARANUM
	IF CHK_DATENOW(CFLAG:LOCAL:데이트중)
		CALL DATE_EVENT(LOCAL)
		CALL SET_DATE(99, LOCAL)
	ENDIF
NEXT
SIF CHK_DATENOW(CFLAG:MASTER:데이트중)
	CALL SET_DATE(99, MASTER)
TFLAG:외출중 = 0

CFLAG:MASTER:현재위치 = GET_ENTRANCE(MAIN_MAP)

@귀가의시간경과
;남은 시간 산출
LOCAL = (GET_DATE_PLACE(CFLAG:MASTER:현재위치)) * 10
IF LOCAL && (TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) - LOCAL) > 0
	;도중의 경우
	TIME = TIME + (TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중) - LOCAL)
ELSE
	;데이트처 도착 끝난 경우
	TIME = TIME + TIME_REQUIRED(MAIN_MAP, CFLAG:MASTER:데이트중)
ENDIF
CALL 모리야복권데이트상대의리셋()

@외출처로부터권할수있을까(ARG)
LOCAL = FLAG:데이트상대
IF LOCAL != ARG && LOCAL != MASTER
	PRINTFORM %CALLNAME:LOCAL%가 %CALLNAME:MASTER%
	;심약계
	IF CFLAG:LOCAL:성격경향 == 1
		PRINTFORML 의 옷의 옷자락을 잡아 거절하고 있다
	;강경세계
	ELSEIF CFLAG:LOCAL:성격경향 == 2
		PRINTFORML 를 번쩍빛나는 눈으로 응시해 온다
	;솔직함계
	ELSEIF CFLAG:LOCAL:성격경향 == 3
		PRINTFORML 를 응시하면서 나만을 보았으면 좋겠다고 알려온다
	;진면목계
	ELSEIF CFLAG:LOCAL:성격경향 == 4
		PRINTFORML 에게 그것은 안 된다며 참견해 온다
	;그 외
	ELSEIF CFLAG:LOCAL:성격경향 == 5
		PRINTFORML 서투른 숨을 향하여, 거절했다
	ENDIF
	PRINTFORMW %마스터는% %CALLNAME:ARG%를 권하는 것을 단념했다
	RETURN 0
ENDIF
IF ARG == 93 && !ITEM:간이풀장
	PRINTW 그녀는 데리고 갈 수 없다…
	RETURN 0
ELSEIF BASE:ARG:기력 < 500
	PRINTFORMW %CALLNAME:ARG%는 피곤한 것 같다
	RETURN 0
ELSEIF !CHARA_HOLIDAY(ARG) && BASE:ARG:일량 && TCVAR:ARG:일개시 < TIME + 180
	PRINTFORMW %CALLNAME:ARG%는 지금부터 일이 있다
	RETURN 0
ELSE
	CFLAG:ARG:거점내방 = 1
	RETURN 1
ENDIF


;FileName_DATE_CMN.ERB ------------------------------- Rev1. 00
;데이트 신청할 수 있을까
;-----------------------------------------------------------
@CAN_DATE(ARG)
#FUNCTION

SIF !CHK_DATENOW(CFLAG:MASTER:데이트중)
	RETURNF 0
SIF !SHIRAHU(ARG)
	RETURNF 0
SIF CFLAG:MASTER:현재위치 == OMANEKIBEYA()
	RETURNF 0
SIF FLAG:데이트상대
	RETURNF 0
SIF !VISIT(ARG)
	RETURNF 0
SIF !CFLAG:ARG:태도
	RETURNF 0
SIF CFLAG:ARG:빡침
	RETURNF 0
SIF CFLAG:ARG:행동 == 5
	RETURNF 0
SIF CHK_DATENOW(CFLAG:ARG:데이트중)
	RETURNF 0

RETURNF 1