@HININSHITE(ARG)

IF ESTRUS_CYCLE(ARG) == 150
	LOCALS = 위험일이
ELSEIF ESTRUS_CYCLE(ARG) != 15
	LOCALS = 안전한 날이 아니
ENDIF

PRINTFORML %ARG는% 오늘이 %LOCALS%므로 제대로 피임해 달라고 말했다…
CALL KOJO_MESSAGE_SEND("EVENT",18,TARGET,1,0)
{
	CALL ASK_M("포기한다",1,@"콘돔을 착용한다(나머지 {ITEM:45}장)",(ITEM:45||FLAG:개인실입장),@"피임약을 건네준다(나머지 {ITEM:49}정)",ITEM:49,
	"생으로 하게 해주세요 부탁 드려요", !TCVAR:간절히원함, "아니 임신만은 꼭 시켜 주겠다", (TEQUIP:TARGET:밧줄 || TEQUIP:TARGET:구속 || CFLAG:TARGET:패배자))
}

IF RESULT == 1
	SIF !FLAG:개인실입장
		ITEM:45 -= 1
	PRINTL 콘돔을 착용했다
	TEQUIP:MASTER:콘돔 = 1
ELSEIF RESULT == 2
	ITEM:49 -= 1
	TCVAR:ARG:피임약 = 1
	PRINTFORML %CALLNAME:ARG%에게 피임약을 먹였다
ELSEIF RESULT == 3
	TCVAR:ARG:간절히원함 = 1
	CALL OGAMITAOSHI(ARG)
	SIF RESULT == -1
			RETURN -1
ELSEIF RESULT == 4
	TCVAR:ARG:억지로 = 1
ELSE
	PRINTFORML 유감스럽지만 포기하자
	RESULT = -1
	RETURN -1
ENDIF
RETURN 0


@피임요구(ARG)
SIF CFLAG:ARG:생해금  == 2
	RETURN
SIF !임신가부(ARG)
	RETURN
SIF !HAS_PENIS(MASTER)
	RETURN
SIF TALENT:ARG:무지
	RETURN
SIF TFLAG:16
	RETURN
SIF TCVAR:ARG:억지로
	RETURN
SIF !SHIRAHU(ARG)
	RETURN
SIF TCVAR:ARG:삽입거절
	RETURN -1
;안전일
SIF ESTRUS_CYCLE(ARG) == 15
	RETURN
IF !CFLAG:ARG:생해금
	CALL HININSHITE(ARG)
ELSEIF ESTRUS_CYCLE(ARG) == 150
	CALL HININSHITE(ARG)
ENDIF
SIF RESULT == -1
	RETURN -1


@임신가부(ARG)
#FUNCTION
SIF TEQUIP:PLAYER:콘돔 || TCVAR:ARG:피임약
	RETURNF 0
SIF TALENT:ARG:유치 && !TALENT:ARG:초경
	RETURNF 0
SIF ((TALENT:ARG:비생물 || TALENT:ARG:봉래인) && !CFLAG:ARG:육아인원수) || TALENT:ARG:임신
	RETURNF 0
RETURNF 1

@AUTO_CONTRACEPTION(ARG)
IF CFLAG:ARG:임신경과일수 <= 16 && TALENT:ARG:임신
	PRINTFORMW 안정기까지는 그만두자
	RETURN -1
ENDIF
IF CFLAG:ARG:임신경과일수 > 36 && TALENT:ARG:임신
	PRINTFORMW 아기가 걱정되니 그만두자
	RETURN -1
ENDIF
SIF !TALENT:ARG:육아중
	RETURN
SIF !HAS_PENIS(MASTER)
	RETURN
SIF TEQUIP:PLAYER:콘돔 || TCVAR:ARG:피임약
	RETURN
SIF CFLAG:ARG:출산경과일 >= CHILD_취학
	RETURN
PRINTFORML 육아중인 %CALLNAME:ARG%의 부담을 늘리면 안되니 피임하자
CALL ASK_M("콘돔을 착용한다",ITEM:콘돔,"피임약을 먹인다",ITEM:피임약,"포기한다",1)
SELECTCASE RESULT
	CASE 0
		ITEM:콘돔 --
		TEQUIP:PLAYER:콘돔 = 1
		PRINTL 콘돔을 착용했다
		RETURN 1
	CASE 1
		ITEM:피임약 --
		TCVAR:ARG:피임약 = 1
		PRINTFORML %CALLNAME:ARG%에게 피임약을 먹였다 
		RETURN 1
	CASE 2
		PRINTFORML 유감스럽지만 포기하기로 했다
		RETURN -1
ENDSELECT

@ChkBeforeInsert(ARG)
CALL AUTO_SKIN_EQUIP
IF GROUPMATCH(TALENT:ARG:처녀, 1, -1)
	CALL LOST_VIRGIN_STOP(ARG)
	SIF RESULT == -1
		RETURN -1
ENDIF
CALL AUTO_CONTRACEPTION(ARG)
SIF RESULT == -1
	RETURN -1
CALL 피임요구(ARG)
IF RESULT == -1
	RETURN -1
ENDIF
