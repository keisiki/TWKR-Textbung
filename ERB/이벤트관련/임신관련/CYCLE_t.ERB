@ESTRUS_CYCLE(ARG)
#FUNCTION
SELECTCASE CFLAG:(ARG:0):900
	;안전한 날
	CASE 1 TO 2
		LOCAL = 15
	CASE 3 TO 4
		LOCAL = 30
	CASE 5
		LOCAL = 50
	CASE 6
		LOCAL = 70
	;위험일
	CASE 7
		LOCAL = 150
	CASE 8
		LOCAL = 100
	CASE 9
		LOCAL = 60
	CASE 10
		LOCAL = 40
ENDSELECT
;SIF TCVAR:ARG:강제배란
;	LOCAL = 100
RETURNF LOCAL

@REAL_ESTRUS_CYCLE(ARG)
#FUNCTION
	LOCAL = ESTRUS_CYCLE(ARG)
	SIF TCVAR:ARG:강제배란
		LOCAL = MAX(LOCAL, LOCAL / 5 + 100)
RETURNF LOCAL


;생리주기 문자 F함수
;다음날등의 상태를 참조할 수 있다
@ESTRUS_CATEGORY(C_ID, ADD_DAY)
#FUNCTIONS
#DIM C_ID     ;등록 번호
#DIM ADD_DAY  ;며칠 후를 참조하는지, 0이라면 오늘
#DIM CHECK_DAY;실제로 참조되는 날의 주기
SIF ADD_DAY < 0
	ADD_DAY = -(ABS(ADD_DAY) % 10)
CHECK_DAY = (CFLAG:C_ID:생리주기 + ADD_DAY + 10) % 10
SIF !CHECK_DAY
	CHECK_DAY = 10
SIF TCVAR:C_ID:강제배란
	RETURNF "배란유발제 효과 발휘중"
SELECTCASE CHECK_DAY
;안전한 날
CASE 1 TO 2
	RETURNF "안전한 날"
CASE 6
	RETURNF "위험일 전날"
;위험일
CASE 7
	RETURNF "위험일"
CASE 8
	RETURNF "배란"
ENDSELECT



;생리주기 표시 함수
;비슷한의가 몇도 있었으므로 전부 여기서 처리해버린다
@NEW_CYCLE_PRINT(C_ID, ADD_DAY, OP)
#DIM  C_ID    ;등록 번호
#DIM  ADD_DAY ;며칠 후를 참조하는지, 0이라면 오늘
#DIMS OP      ;옵션, 현재 「등폭」마셔
#DIMS 표시문  ;표시되는 내용
VARSET 표시문
IF TALENT:C_ID:임신
	SETCOLOR C_PINK
	표시문 '= CLIP_HEART("임신")
ELSEIF CFLAG:C_ID:임신경과일수
	SETCOLOR C_PINK
	표시문 '= CLIP_HEART("착상제")
ELSEIF !ADD_DAY && TCVAR:C_ID:발정
	SETCOLOR C_PINK
	표시문 '= CLIP_HEART("발정중")
ELSE
	표시문 '= ESTRUS_CATEGORY(C_ID, ADD_DAY)
	SIF !STRLENS(표시문)
		RETURN
	SELECTCASE 표시문
	CASE "위험일"
		SETCOLOR C_PINK
		표시문 '= CLIP_HEART(표시문)
	CASE "배란", "위험일 전날", "배란유발제 효과 발휘중"
		SETCOLOR 0xEE60EE
	CASE "안전한 날"
		SETCOLOR C_AQUA
	ENDSELECT
ENDIF
IF STRCOUNT(OP, "「등폭」")
	PRINTFORM %표시문, 10, LEFT%
ELSE
	PRINTFORM %표시문%
ENDIF
RESETCOLOR


@CYCLE_PRINT(ARG)
CALL NEW_CYCLE_PRINT(ARG)
RETURN

VARSET LOCAL
IF TALENT:ARG:임신
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 임신{CFLAG:ARG:임신경과일수}일째
	CALL HEART
ELSEIF CFLAG:ARG:임신경과일수
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 착상제
	CALL HEART
ELSEIF ESTRUS_CYCLE(ARG) == 150
	SETCOLOR C_PINK
	CALL HEART
	IF TCVAR:ARG:발정
		PRINTFORM 발정중
	ELSE
		PRINTFORM 위험일
	ENDIF
	CALL HEART
ELSEIF ESTRUS_CYCLE(ARG) == 100
	SETCOLOR 0xEE60EE
	PRINTFORM 배란
ELSEIF ESTRUS_CYCLE(ARG) == 70
	SETCOLOR 0xEE60EE
	PRINTFORM 위험일 전날
ELSEIF ESTRUS_CYCLE(ARG) == 15
	SETCOLOR C_AQUA
	PRINTFORM 안전한 날
ENDIF
RESETCOLOR

@CYCLE_PRINT다음날(ARG)
CALL NEW_CYCLE_PRINT(ARG, 1)
RETURN

VARSET LOCAL
IF TALENT:ARG:임신
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 임신
	CALL HEART
ELSEIF CFLAG:ARG:임신경과일수
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 착상제
	CALL HEART
ELSEIF CFLAG:ARG:900 == 6
	SETCOLOR C_PINK
	CALL HEART
	IF TCVAR:ARG:발정
		PRINTFORM 발정중
	ELSE
		PRINTFORM 위험일
	ENDIF
	CALL HEART
ELSEIF CFLAG:ARG:900 == 7
	SETCOLOR 0xEE60EE
	PRINTFORM 배란
ELSEIF CFLAG:ARG:900 == 5
	SETCOLOR 0xEE60EE
	PRINTFORM 위험일 전날
ELSEIF CFLAG:ARG:900 == 10 || CFLAG:ARG:900 == 1
	SETCOLOR C_AQUA
	PRINTFORM 안전한 날
ENDIF
RESETCOLOR




;@CYCLE_PRINT다음날()을 표시 무너지고 하지 않게
;텍스트를 같은 폭으로 출력하도록(듯이) 한 것
@PRINT_CYCLE_다음날(캐릭터등록번호)
#DIM 캐릭터등록번호
#DIMS 표시문
CALL NEW_CYCLE_PRINT(캐릭터등록번호, 1, "「등폭」")
RETURN

표시문 = 
IF TALENT:캐릭터등록번호:임신
	SETCOLOR C_PINK
	표시문 = %CLIP_HEART("임신")%
ELSE
	SELECTCASE CFLAG:캐릭터등록번호:생리주기
	CASE 6
		SETCOLOR C_PINK
		IF TCVAR:캐릭터등록번호:발정
			표시문 = %CLIP_HEART("발정중")%
		ELSE
			표시문 = %CLIP_HEART("위험일")%
		ENDIF
	CASE 7
		SETCOLOR 0xEE60EE
		표시문 = 배란
	CASE 5
		SETCOLOR 0xEE60EE
		표시문 = 위험일 전날
	CASE 10, 1
		SETCOLOR C_AQUA
		표시문 = 안전한 날
	ENDSELECT
ENDIF
PRINTFORM %표시문, 10, LEFT%
RESETCOLOR

